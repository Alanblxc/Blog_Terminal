# 全面合并计划：脚本和配置文件

## 1. 合并目标
1. 将 `copy-posts.js` 功能合并到 `generate-posts-json.js`
2. 将 `file.toml` 配置合并到 `config.toml`
3. 简化项目结构，减少文件数量
4. 保持所有原有功能完整

## 2. 合并策略

### 2.1 合并 copy-posts.js 到 generate-posts-json.js
1. **保留主文件**：以 `generate-posts-json.js` 为基础，整合 `copy-posts.js` 的功能
2. **移除重复代码**：删除重复的 post 目录复制逻辑，保留完整的复制功能
3. **整合功能**：
   - 生成 posts.json 文件
   - 复制 post 目录到 dist
   - 复制 README.md 到 dist
   - 复制 posts.json 到 dist
4. **优化代码结构**：保持功能模块化，代码清晰易维护

### 2.2 合并 file.toml 到 config.toml
1. **添加配置项**：在 `config.toml` 中添加 `[download]` 部分
2. **保留原有格式**：保持下载配置的原有结构，确保兼容性
3. **统一配置文件**：所有配置集中到一个文件，便于管理

## 3. 实现步骤

### 步骤 1：修改 generate-posts-json.js
1. 添加复制根目录 README.md 到 dist 的功能
2. 添加复制 posts.json 到 dist 的功能
3. 优化复制目录函数，显示详细的复制日志
4. 确保所有复制操作都有完善的错误处理

### 步骤 2：更新 config.toml
1. 添加 `[download]` 部分
2. 将 file.toml 中的所有下载配置复制到 config.toml
3. 保持原有配置结构不变

### 步骤 3：更新 generate-posts-json.js 的 TOML 解析
1. 修改 generate-posts-json.js 中的 TOML 解析逻辑
2. 更新为从 config.toml 读取下载配置
3. 调整解析路径，确保能正确读取合并后的配置

### 步骤 4：更新 package.json
1. 修改 `build` 脚本，移除对 `copy-posts.js` 的调用
2. 修改 `copy-posts` 脚本，直接调用合并后的 `generate-posts-json.js`

### 步骤 5：删除冗余文件
1. 删除不再需要的 `copy-posts.js` 文件
2. 删除不再需要的 `file.toml` 文件

## 4. 预期效果
- 项目中减少两个文件
- 所有配置集中到一个文件，便于管理
- 构建流程简化
- 保持所有原有功能完整
- 提高代码和配置的可维护性

## 5. 关键功能保留
- 生成 posts.json 文件
- 复制 post 目录到 dist
- 复制 README.md 到 dist
- 复制 posts.json 到 dist
- 下载配置管理
- 详细的日志输出
- 完善的错误处理

## 6. 代码和配置结构

### 6.1 generate-posts-json.js 结构
```javascript
// 1. 导入依赖
// 2. 配置常量
// 3. 生成 posts.json 的核心功能
// 4. 复制功能（合并后的）
//    - 复制 post 目录
//    - 复制 README.md
//    - 复制 posts.json
// 5. 输出结果
```

### 6.2 config.toml 结构
```toml
# 应用基本配置
[app]
user = "Alan"

# UI相关配置
[ui]
fontSize = "16"

# 背景配置
[background]
image = "/background.jpg"
opacity = "0.9"

# 主题配置
[theme]
current = "default"
available = ["default", "dark", "light", "solarized", "dracula"]

# 下载文件配置
[download.books]
"vue3-guide.pdf" = "https://example.com/vue3-guide.pdf"
"javascript-advanced.pdf" = "https://example.com/javascript-advanced.pdf"

[download.tools]
"terminal-theme.zip" = "https://example.com/terminal-theme.zip"
"markdown-cheatsheet.pdf" = "https://example.com/markdown-cheatsheet.pdf"

[download.images]
"background-1.jpg" = "https://example.com/background-1.jpg"
"background-2.jpg" = "https://example.com/background-2.jpg"
```

通过这个全面的合并计划，我们将简化项目结构，减少文件数量，同时保持所有原有功能完整，提高代码和配置的可维护性。